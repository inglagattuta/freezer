<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Freezer Inventory ‚Äî Mobile First</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    :root{
      --bg-1:#071020;
      --bg-2:#0c2236;
      --card-bg:rgba(255,255,255,0.06);
      --card-border:rgba(255,255,255,0.08);
      --glass-blur:20px;
    }

    body{
      background:linear-gradient(180deg,var(--bg-1),var(--bg-2));
      font-family:Inter,-apple-system,system-ui;
      overflow-x:hidden; /* üî• evita scroll orizzontale */
      color:#E6F0FF;
    }

    .glass{
      background:var(--card-bg);
      border:1px solid var(--card-border);
      backdrop-filter:blur(var(--glass-blur));
      -webkit-backdrop-filter:blur(var(--glass-blur));
    }

    /* Fix menu a tendina */
    select, select option{
      color:#000 !important;
      background:#fff !important;
    }
  </style>
</head>

<body class="py-4">
  <div id="root" class="w-full max-w-full px-3 mx-auto"></div>

  <script type="text/babel" data-presets="react">
    const { useState, useEffect, useRef } = React;

    const firebaseConfig = {
      apiKey: "AIzaSyBmWi-5wQ97PA4TanAC5mHFAqmsNR9aUpE",
      authDomain: "lista-spesa-famiglia-95127.firebaseapp.com",
      projectId: "lista-spesa-famiglia-95127",
      storageBucket: "lista-spesa-famiglia-95127.firebasestorage.app",
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const CAT = {
      carne:{bg:'rgba(248,113,113,0.12)',color:'#fecaca'},
      pesce:{bg:'rgba(119,199,255,0.12)',color:'#bfdbfe'},
      verdure:{bg:'rgba(110,231,183,0.12)',color:'#bbf7d0'},
      frutta:{bg:'rgba(250,204,21,0.12)',color:'#fef08a'},
      pane:{bg:'rgba(250,215,131,0.12)',color:'#fef3c7'},
      pronti:{bg:'rgba(174,153,255,0.12)',color:'#e9d5ff'},
      altro:{bg:'rgba(255,255,255,0.04)',color:'#d1d5db'},
    };

    const today = () => new Date().toISOString().split('T')[0];

    function App(){
      const [items,setItems] = useState([]);
      const [loading,setLoading] = useState(true);
      const [editingId,setEditingId] = useState(null);
      const nameRef = useRef(null);

      const [form,setForm] = useState({
        nome:'',
        quantita:1,
        unita:'pz',
        categoria:'altro',
        addedDate:today(),
        expiryDate:''
      });

      useEffect(()=>{
        const unsub = db.collection("freezer")
        .orderBy("createdAt","desc")
        .onSnapshot(snap=>{
          setItems(snap.docs.map(d=>({id:d.id,...d.data()})));
          setLoading(false);
        });

        return ()=>unsub();
      },[]);

      function saveItem(e){
        e.preventDefault();
        if(!form.nome.trim())return;

        const data = {
          ...form,
          quantita:Number(form.quantita),
          updatedAt:firebase.firestore.FieldValue.serverTimestamp()
        };

        if(editingId){
          db.collection("freezer").doc(editingId).update(data);
        } else {
          db.collection("freezer").add({
            ...data,
            createdAt:firebase.firestore.FieldValue.serverTimestamp()
          });
        }

        resetForm();
      }

      function resetForm(){
        setEditingId(null);
        setForm({
          nome:'',quantita:1,unita:'pz',categoria:'altro',addedDate:today(),expiryDate:''
        });
      }

      function editItem(it){
        setEditingId(it.id);
        setForm({
          nome:it.nome,
          quantita:it.quantita,
          unita:it.unita,
          categoria:it.categoria,
          addedDate:it.addedDate || today(),
          expiryDate:it.expiryDate || ''
        });
        setTimeout(()=>nameRef.current?.focus(),50);
      }

      function removeItem(id){
        if(confirm("Eliminare?"))
          db.collection("freezer").doc(id).delete();
      }

      const daysTo = d => d ? Math.ceil((new Date(d)-new Date())/(1000*60*60*24)) : null;

      return (
        <div className="glass p-4 rounded-2xl mx-auto w-full max-w-md">
          
          {/* HEADER */}
          <h2 className="text-xl font-semibold mb-1">üçΩÔ∏è Freezer Inventory</h2>
          <p className="text-xs text-slate-300 mb-4">Versione mobile ottimizzata</p>

          {/* FORM ‚Äî single column mobile */}
          <form onSubmit={saveItem} className="space-y-3">

            <input ref={nameRef}
              className="w-full px-3 py-2 rounded-xl bg-white/10 border border-white/20 text-white"
              placeholder="Nome prodotto"
              value={form.nome}
              onChange={e=>setForm({...form,nome:e.target.value})}
            />

            <div className="grid grid-cols-3 gap-2">
              <input type="number"
                className="px-3 py-2 rounded-xl bg-white/10 border border-white/20 text-white"
                value={form.quantita}
                min="1"
                onChange={e=>setForm({...form,quantita:e.target.value})}
              />
              <select
                className="px-3 py-2 rounded-xl border border-white/20"
                value={form.unita}
                onChange={e=>setForm({...form,unita:e.target.value})}
              >
                <option value="pz">pz</option>
                <option value="kg">kg</option>
                <option value="g">g</option>
                <option value="l">l</option>
                <option value="confezioni">confezioni</option>
              </select>

              <select
                className="px-3 py-2 rounded-xl border border-white/20"
                value={form.categoria}
                onChange={e=>setForm({...form,categoria:e.target.value})}
              >
                <option value="carne">Carne</option>
                <option value="pesce">Pesce</option>
                <option value="verdure">Verdure</option>
                <option value="frutta">Frutta</option>
                <option value="pane">Pane</option>
                <option value="pronti">Pronti</option>
                <option value="altro">Altro</option>
              </select>
            </div>

            <input type="date"
              className="w-full px-3 py-2 rounded-xl border border-white/20 bg-white/10 text-white"
              value={form.expiryDate}
              onChange={e=>setForm({...form,expiryDate:e.target.value})}
            />

            <button className="w-full py-2 rounded-xl bg-blue-500 text-white font-semibold">
              {editingId ? "Salva" : "Aggiungi"}
            </button>

            {editingId && (
              <button type="button" onClick={resetForm}
                className="w-full py-2 rounded-xl bg-white/10 text-slate-300 border border-white/20">
                Annulla
              </button>
            )}
          </form>

          {/* LISTA ITEM */}
          <div className="mt-5 space-y-3">
            {loading ? (
              <p className="text-center text-slate-400">Caricamento‚Ä¶</p>
            ) : items.length === 0 ? (
              <p className="text-center text-slate-400">Nessun elemento</p>
            ) : (
              items.map(it=>{
                const days = daysTo(it.expiryDate);
                const cat = CAT[it.categoria] || CAT.altro;

                return (
                  <div key={it.id}
                    className="p-3 rounded-xl bg-white/5 border border-white/10">
                    
                    <div className="flex flex-col gap-1">
                      <div className="flex items-center gap-2">
                        <span className="px-2 py-1 rounded-full text-xs font-semibold"
                          style={{background:cat.bg,color:cat.color}}>
                          {it.categoria}
                        </span>

                        <span className="font-semibold">{it.nome}</span>
                      </div>

                      <span className="text-xs text-slate-300">
                        {it.quantita} {it.unita} ‚Äî {it.addedDate}
                      </span>

                      {days!==null && (
                        <span className="text-xs text-slate-400">
                          {days<0?"Scaduto":days===0?"Scade oggi":`Scade tra ${days} giorni`}
                        </span>
                      )}
                    </div>

                    <div className="flex gap-2 mt-2">
                      <button className="flex-1 py-2 rounded-lg bg-white/10 text-xs"
                        onClick={()=>editItem(it)}>
                        Modifica
                      </button>

                      <button className="flex-1 py-2 rounded-lg bg-red-500/20 text-red-300 text-xs"
                        onClick={()=>removeItem(it.id)}>
                        Elimina
                      </button>
                    </div>
                  </div>
                );
              })
            )}
          </div>

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
